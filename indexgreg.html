<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SUI Wallet Detection & Connection</title>
  <style>
    body { 
      background: #181c24; 
      color: #fff; 
      font-family: sans-serif; 
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      color: #6366f1;
      text-align: center;
    }
    .section {
      background: #2a2d36;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .wallet-btn { 
      padding: 12px 24px; 
      border-radius: 8px; 
      font-size: 1.1em; 
      border: none; 
      margin: 8px; 
      background: #6366f1; 
      color: white; 
      cursor: pointer;
      min-width: 200px;
    }
    .wallet-btn:hover:not(:disabled) { 
      background: #5856eb; 
    }
    .wallet-btn:disabled { 
      background: #555; 
      cursor: not-allowed;
    }
    .wallet-btn.not-installed {
      background: #7f1d1d;
    }
    .debug-info {
      background: #1e293b;
      border: 1px solid #475569;
      border-radius: 6px;
      padding: 15px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 0.9em;
      white-space: pre-wrap;
    }
    .success { 
      background: #065f46; 
      color: #d1fae5; 
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .error { 
      background: #7f1d1d; 
      color: #fecaca; 
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .address {
      word-break: break-all;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç SUI Wallet Detection & Connection</h1>
    
    <div class="section">
      <h2>üîß Debug Information</h2>
      <div id="debug-info" class="debug-info"></div>
    </div>

    <div class="section">
      <h2>üëõ Available Wallets</h2>
      <div id="wallets"></div>
    </div>

    <div class="section">
      <h2>üìù Connection Status</h2>
      <div id="status"></div>
    </div>
  </div>

  <script>
    const debugDiv = document.getElementById('debug-info');
    const walletsDiv = document.getElementById('wallets');
    const statusDiv = document.getElementById('status');

    // Function pour afficher les informations de debug
    function updateDebugInfo() {
      const walletObjects = {
        // Phantom
        'window.phantom': !!window.phantom,
        'window.phantom.sui': !!(window.phantom && window.phantom.sui),
        'window.phantom.solana': !!(window.phantom && window.phantom.solana),
        'window.phantom.ethereum': !!(window.phantom && window.phantom.ethereum),
        
        // Slush/SUI Wallet
        'window.suiWallet': !!window.suiWallet,
        'window.slush': !!window.slush,
        'window.slushWallet': !!window.slushWallet,
        
        // Autres wallets SUI
        'window.martian': !!window.martian,
        'window.ethosWallet': !!window.ethosWallet,
        'window.suiet': !!window.suiet,
        'window.nightly': !!window.nightly,
        
        // Recherche g√©n√©rale
        'Object.keys(window).filter(k => k.includes("sui"))': Object.keys(window).filter(k => k.toLowerCase().includes('sui')),
        'Object.keys(window).filter(k => k.includes("phantom"))': Object.keys(window).filter(k => k.toLowerCase().includes('phantom')),
        'Object.keys(window).filter(k => k.includes("wallet"))': Object.keys(window).filter(k => k.toLowerCase().includes('wallet')),
      };

      // Debug avanc√© pour Phantom
      if (window.phantom) {
        walletObjects['phantom methods'] = Object.getOwnPropertyNames(window.phantom);
        walletObjects['phantom prototype'] = Object.getOwnPropertyNames(Object.getPrototypeOf(window.phantom));
        
        // V√©rifier les propri√©t√©s sp√©cifiques
        if (window.phantom.sui) {
          walletObjects['phantom.sui methods'] = Object.getOwnPropertyNames(window.phantom.sui);
        }
        if (window.phantom.request) {
          walletObjects['phantom.request available'] = 'YES';
        }
        if (window.phantom.connect) {
          walletObjects['phantom.connect available'] = 'YES';
        }
      }

      debugDiv.textContent = JSON.stringify(walletObjects, null, 2);
    }

    // Configurations des wallets avec diff√©rentes approches de d√©tection
    const suiWallets = [
      {
        name: "Phantom (SUI)",
        key: "phantom-sui",
        detector: () => {
          // V√©rifier les diff√©rentes fa√ßons dont Phantom peut √™tre expos√©
          if (window.phantom) {
            // V√©rifier si SUI est support√© dans Phantom
            return window.phantom;
          }
          return null;
        },
        connect: async function() {
          const provider = this.detector();
          if (!provider) throw new Error("Phantom not found");
          
          // Essayer diff√©rentes m√©thodes d'API Phantom pour SUI
          try {
            // M√©thode 1: API directe SUI (si disponible)
            if (provider.sui && provider.sui.connect) {
              const result = await provider.sui.connect();
              return result.accounts?.[0] || result.address || result.publicKey;
            }
            
            // M√©thode 2: API request g√©n√©rique
            if (provider.request) {
              try {
                const result = await provider.request({ 
                  method: 'sui_connect',
                  params: {} 
                });
                return result.accounts?.[0] || result.address || result;
              } catch (e) {
                // Si sui_connect ne fonctionne pas, essayer connect
                const result = await provider.request({ 
                  method: 'connect',
                  params: { chain: 'sui' }
                });
                return result.accounts?.[0] || result.address || result;
              }
            }
            
            // M√©thode 3: API connect standard avec cha√Æne
            if (provider.connect) {
              const result = await provider.connect({ onlyIfTrusted: false });
              return result.accounts?.[0] || result.address || result.publicKey;
            }
            
            throw new Error("No compatible SUI API found in Phantom");
            
          } catch (error) {
            throw new Error(`Phantom SUI connection failed: ${error.message}`);
          }
        }
      },
      {
        name: "Slush Wallet (ex-Sui Wallet)",
        key: "slush",
        detector: () => window.suiWallet || window.slush || window.slushWallet,
        connect: async function() {
          const provider = this.detector();
          if (!provider) throw new Error("Slush Wallet not found");
          const result = await provider.connect();
          return result.accounts?.[0] || result.address || result;
        }
      },
      {
        name: "Martian Wallet",
        key: "martian",
        detector: () => window.martian,
        connect: async function() {
          const provider = this.detector();
          if (!provider) throw new Error("Martian Wallet not found");
          const result = await provider.connect();
          return result.address || result.accounts?.[0] || result;
        }
      },
      {
        name: "Ethos Wallet",
        key: "ethos",
        detector: () => window.ethosWallet,
        connect: async function() {
          const provider = this.detector();
          if (!provider) throw new Error("Ethos Wallet not found");
          const result = await provider.connect();
          return result.accounts?.[0] || result.address || result;
        }
      },
      {
        name: "Suiet Wallet",
        key: "suiet",
        detector: () => window.suiet,
        connect: async function() {
          const provider = this.detector();
          if (!provider) throw new Error("Suiet Wallet not found");
          const result = await provider.connect();
          return result.accounts?.[0] || result.address || result;
        }
      },
      {
        name: "Nightly Wallet",
        key: "nightly",
        detector: () => window.nightly,
        connect: async function() {
          const provider = this.detector();
          if (!provider) throw new Error("Nightly Wallet not found");
          const result = await provider.connect();
          return result.accounts?.[0] || result.address || result;
        }
      }
    ];

    function updateStatus(message, type = 'info') {
      statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
    }

    function createWalletButton(wallet) {
      const btn = document.createElement('button');
      const provider = wallet.detector();
      
      if (provider) {
        btn.textContent = `‚úÖ Connect ${wallet.name}`;
        btn.className = 'wallet-btn';
      } else {
        btn.textContent = `‚ùå ${wallet.name} (Not Detected)`;
        btn.className = 'wallet-btn not-installed';
        btn.disabled = true;
      }
      
      btn.onclick = async () => {
        if (!provider) {
          updateStatus(`${wallet.name} is not detected. Please make sure it's installed and enabled.`, 'error');
          return;
        }

        btn.disabled = true;
        const originalText = btn.textContent;
        btn.textContent = '‚è≥ Connecting...';
        updateStatus('Connecting to wallet...', 'info');

        try {
          const address = await wallet.connect();
          updateStatus(`üéâ Connected to ${wallet.name}!<br><div class="address">Address: ${address}</div>`, 'success');
        } catch (error) {
          console.error('Connection error:', error);
          updateStatus(`‚ùå Failed to connect: ${error.message}`, 'error');
        } finally {
          btn.disabled = false;
          btn.textContent = originalText;
        }
      };
      
      return btn;
    }

    // Initialisation
    function init() {
      updateDebugInfo();
      
      // Cr√©er les boutons de wallet
      suiWallets.forEach(wallet => {
        walletsDiv.appendChild(createWalletButton(wallet));
      });

      // V√©rifier si des wallets sont disponibles
      const availableWallets = suiWallets.filter(w => w.detector());
      if (availableWallets.length === 0) {
        updateStatus('‚ùå No SUI wallets detected. Please install and enable a SUI wallet.', 'error');
      } else {
        updateStatus(`‚úÖ ${availableWallets.length} SUI wallet(s) detected: ${availableWallets.map(w => w.name).join(', ')}`, 'success');
      }
    }

    // Attendre que les wallets soient inject√©s
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(init, 1000); // Attendre 1s pour l'injection des wallets
      });
    } else {
      setTimeout(init, 1000);
    }

    // Bouton pour actualiser la d√©tection
    const refreshBtn = document.createElement('button');
    refreshBtn.textContent = 'üîÑ Refresh Detection';
    refreshBtn.className = 'wallet-btn';
    refreshBtn.onclick = () => {
      walletsDiv.innerHTML = '';
      init();
    };
    walletsDiv.appendChild(refreshBtn);
  </script>
</body>
</html>
