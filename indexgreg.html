<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phantom SUI Wallet Connector</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body { 
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #fff; 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 500px;
      width: 100%;
      padding: 20px;
    }

    .main-card {
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .version-badge {
      position: fixed; 
      top: 10px; 
      right: 10px; 
      background: rgba(99, 102, 241, 0.2); 
      border: 1px solid rgba(99, 102, 241, 0.4); 
      border-radius: 6px; 
      padding: 8px 12px; 
      font-size: 0.8rem; 
      color: #a5b4fc; 
      z-index: 9999;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #6366f1, #8b5cf6, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #94a3b8;
      margin-bottom: 30px;
      font-size: 1.1rem;
    }

    .wallet-section {
      margin-bottom: 30px;
    }

    .phantom-btn {
      background: linear-gradient(135deg, #AB9FF2, #6366f1);
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      padding: 16px 32px;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .phantom-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(171, 159, 242, 0.4);
    }

    .phantom-btn:disabled {
      background: #555;
      cursor: not-allowed;
      transform: none;
    }

    .phantom-btn.not-available {
      background: #7f1d1d;
    }

    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 12px;
      font-weight: 500;
    }

    .status.success {
      background: rgba(34, 197, 94, 0.2);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #4ade80;
    }

    .status.error {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
    }

    .status.info {
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #60a5fa;
    }

    .address-display {
      margin-top: 15px;
      padding: 12px;
      background: rgba(51, 65, 85, 0.8);
      border-radius: 8px;
      font-family: 'Monaco', monospace;
      font-size: 0.9rem;
      word-break: break-all;
      color: #a5f3fc;
    }

    .wallet-info {
      background: rgba(51, 65, 85, 0.6);
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }

    .wallet-info h3 {
      color: #f1f5f9;
      margin-bottom: 15px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .info-label {
      color: #94a3b8;
    }

    .info-value {
      color: #f1f5f9;
      font-family: monospace;
    }

    .disconnect-btn {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 8px;
      color: #f87171;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 0.9rem;
      margin-top: 15px;
    }

    .disconnect-btn:hover {
      background: rgba(239, 68, 68, 0.3);
    }

    .actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .action-btn {
      flex: 1;
      background: rgba(99, 102, 241, 0.2);
      border: 1px solid rgba(99, 102, 241, 0.3);
      border-radius: 8px;
      color: #a5b4fc;
      padding: 10px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .action-btn:hover {
      background: rgba(99, 102, 241, 0.3);
      color: #c7d2fe;
    }
  </style>
</head>
<body>
  <div class="version-badge">v5.0.0 - Phantom Only</div>
  
  <div class="container">
    <div class="main-card">
      <h1>üëª Phantom SUI</h1>
      <p class="subtitle">Connect your Phantom wallet to access SUI</p>
      
      <div class="wallet-section">
        <button class="phantom-btn" id="phantomBtn">
          <span>üëª</span>
          <span id="phantomBtnText">Connect Phantom Wallet</span>
        </button>
      </div>
      
      <div id="status"></div>
      <div id="walletInfo" style="display: none;"></div>
    </div>
  </div>

  <script>
    let connectedWallet = null;
    let userAddress = null;

    const phantomBtn = document.getElementById('phantomBtn');
    const phantomBtnText = document.getElementById('phantomBtnText');
    const statusDiv = document.getElementById('status');
    const walletInfoDiv = document.getElementById('walletInfo');

    // √âtat de l'application
    let isConnecting = false;

    function updateStatus(message, type = 'info') {
      statusDiv.innerHTML = `<div class="status ${type}">${message.replace(/\n/g, '<br>')}</div>`;
    }

    function updateWalletInfo(address, provider) {
      userAddress = address;
      walletInfoDiv.innerHTML = `
        <div class="wallet-info">
          <h3>üëª Phantom Connected</h3>
          <div class="info-row">
            <span class="info-label">Address:</span>
            <span class="info-value">${address}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Network:</span>
            <span class="info-value">SUI Mainnet</span>
          </div>
          <div class="info-row">
            <span class="info-label">Provider:</span>
            <span class="info-value">Phantom SUI</span>
          </div>
          
          <div class="actions">
            <button class="action-btn" onclick="getBalance()">üí∞ Get Balance</button>
            <button class="action-btn" onclick="signMessage()">‚úçÔ∏è Sign Message</button>
          </div>
          
          <button class="disconnect-btn" onclick="disconnect()">üîå Disconnect</button>
        </div>
      `;
      walletInfoDiv.style.display = 'block';
    }

    async function detectPhantom() {
      // V√©rifier si Phantom est disponible
      if (window.phantom && window.phantom.sui) {
        console.log('üëª Phantom SUI detected directly');
        return window.phantom;
      }

      if (window.phantom) {
        console.log('üëª Phantom detected, checking SUI support...');
        console.log('Available chains:', Object.keys(window.phantom));
        return window.phantom;
      }

      return null;
    }

    async function connectPhantom() {
      if (isConnecting) return;
      
      isConnecting = true;
      phantomBtn.disabled = true;
      phantomBtnText.textContent = 'Connecting...';
      updateStatus('üîÑ Connecting to Phantom...', 'info');

      try {
        const phantom = await detectPhantom();
        
        if (!phantom) {
          throw new Error('Phantom wallet not found. Please install Phantom extension.');
        }

        console.log('üëª Phantom provider:', phantom);
        console.log('üëª Available methods:', Object.getOwnPropertyNames(phantom));

        let result;
        let address;

        // Essayer la connexion SUI sp√©cifique d'abord
        if (phantom.sui && phantom.sui.connect) {
          console.log('üëª Using Phantom SUI API');
          result = await phantom.sui.connect();
          address = result.accounts?.[0] || result.address;
        } 
        // Fallback sur l'API Solana si SUI pas disponible
        else if (phantom.solana && phantom.solana.connect) {
          console.log('üëª Using Phantom Solana API (fallback)');
          result = await phantom.solana.connect({ onlyIfTrusted: false });
          address = result.publicKey?.toString();
        }
        else {
          throw new Error('Phantom SUI not supported. Please enable SUI network in Phantom settings.');
        }

        if (!address) {
          throw new Error('No address returned from Phantom');
        }

        // Connexion r√©ussie
        connectedWallet = phantom;
        phantomBtnText.textContent = 'Connected ‚úÖ';
        phantomBtn.style.background = 'rgba(34, 197, 94, 0.3)';
        
        updateStatus('üéâ Successfully connected to Phantom!', 'success');
        updateWalletInfo(address, phantom);

        console.log('üëª Connection successful:', { address, result });

      } catch (error) {
        console.error('üëª Connection error:', error);
        updateStatus(`‚ùå Connection failed: ${error.message}`, 'error');
        
        phantomBtnText.textContent = 'Retry Connection';
        phantomBtn.disabled = false;
      } finally {
        isConnecting = false;
      }
    }

    async function getBalance() {
      if (!connectedWallet || !userAddress) {
        updateStatus('‚ùå No wallet connected', 'error');
        return;
      }

      updateStatus('üí∞ Getting balance...', 'info');

      try {
        // Simuler r√©cup√©ration de balance (√† remplacer par vraie API SUI)
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // TODO: Int√©grer avec SUI RPC pour r√©cup√©rer le vrai balance
        const mockBalance = (Math.random() * 100).toFixed(2);
        
        updateStatus(`üí∞ Balance: ${mockBalance} SUI`, 'success');
      } catch (error) {
        updateStatus(`‚ùå Failed to get balance: ${error.message}`, 'error');
      }
    }

    async function signMessage() {
      if (!connectedWallet || !userAddress) {
        updateStatus('‚ùå No wallet connected', 'error');
        return;
      }

      updateStatus('‚úçÔ∏è Requesting signature...', 'info');

      try {
        const message = `Hello SUI! Signed at ${new Date().toISOString()}`;
        
        // Utiliser l'API de signature appropri√©e
        let signature;
        if (connectedWallet.sui && connectedWallet.sui.signMessage) {
          signature = await connectedWallet.sui.signMessage({ message });
        } else if (connectedWallet.solana && connectedWallet.solana.signMessage) {
          const encodedMessage = new TextEncoder().encode(message);
          const result = await connectedWallet.solana.signMessage(encodedMessage);
          signature = result.signature;
        } else {
          throw new Error('Signature not supported');
        }

        updateStatus(`‚úçÔ∏è Message signed successfully!<div class="address-display">Signature: ${signature}</div>`, 'success');
      } catch (error) {
        if (error.message.includes('rejected') || error.code === 4001) {
          updateStatus('‚ùå Signature cancelled by user', 'error');
        } else {
          updateStatus(`‚ùå Failed to sign message: ${error.message}`, 'error');
        }
      }
    }

    function disconnect() {
      connectedWallet = null;
      userAddress = null;
      
      phantomBtn.disabled = false;
      phantomBtnText.textContent = 'Connect Phantom Wallet';
      phantomBtn.style.background = '';
      
      walletInfoDiv.style.display = 'none';
      updateStatus('üîå Wallet disconnected', 'info');
    }

    // Event listeners
    phantomBtn.addEventListener('click', connectPhantom);

    // Initialisation
    async function init() {
      const phantom = await detectPhantom();
      
      if (!phantom) {
        phantomBtn.disabled = true;
        phantomBtn.classList.add('not-available');
        phantomBtnText.textContent = 'Phantom Not Installed';
        updateStatus(`‚ùå Phantom wallet not detected.<br><br>üì• <strong>Install Phantom:</strong><br><a href="https://phantom.app/" target="_blank" style="color: #60a5fa;">https://phantom.app/</a>`, 'error');
      } else {
        updateStatus('üëª Phantom detected! Click to connect.', 'success');
      }
    }

    // Lancer l'initialisation
    init();

    // √âcouter les changements de compte Phantom
    if (window.phantom) {
      window.phantom.on?.('accountChanged', (account) => {
        if (account && connectedWallet) {
          console.log('üëª Account changed:', account);
          userAddress = account;
          updateWalletInfo(account, connectedWallet);
        } else if (!account && connectedWallet) {
          disconnect();
        }
      });
    }
  </script>
</body>
</html>
